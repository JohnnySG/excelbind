# The Azure pipeline builds the x86 and x64 release builds.
# No testing is performed in the pipeline, as that would need Excel installed on the build agent.

trigger:
- master

variables:
  solution: '**/excelbind.sln'
  buildConfiguration: 'Release'

jobs:
- job: 'Build'
  strategy:
    matrix:
      DebugWin32:
        buildPlatformPython: 'x86'
        buildPlatform: 'Win32'
        config: 'Debug'
      Debugx64:
        buildPlatformPython: 'x64'
        buildPlatform: 'x64'
        config: 'Debug'
      ReleaseWin32:
        buildPlatformPython: 'x86'
        buildPlatform: 'Win32'
        config: 'Release'
      Releasex64:
        buildPlatformPython: 'x64'
        buildPlatform: 'x64'
        config: 'Release'

  pool:
    vmImage: 'windows-latest'

  steps:
  - checkout: self
    submodules: true

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.7'
      addToPath: true
      architecture: $(buildPlatformPython)

  - script: set
    displayName: View env vars

  - task: NuGetToolInstaller@1

  - task: CmdLine@2
    inputs:
      script: |
        make 2019 $(config) $(buildPlatform)


  - task: CmdLine@2
    inputs:
      script: |
        git config user.email "53918463+RuneLjungmann@users.noreply.github.com"
        git config user.name "RuneLjungmann"
        git checkout master
        git commit -a -m "Azure Pipeline: Updated binaries" -m "[skip ci]"
        git push origin